-- MySQL Script generated by MySQL Workbench
-- Tue Oct 10 22:19:26 2023
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- CREACION DE USUARIO
-- -----------------------------------------------------
CREATE USER 'kevin'@'localhost' IDENTIFIED BY '123456789';
GRANT ALL PRIVILEGES ON hospital.* TO 'kevin'@'localhost';
FLUSH PRIVILEGES;

-- -----------------------------------------------------
-- Schema hospital
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `hospital` DEFAULT CHARACTER SET utf8 ;
USE `hospital` ;

-- -----------------------------------------------------
-- Table `hospital`.`usuarios`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`usuarios` (
  `ID_usuario` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `mail` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `pass` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`ID_usuario`),
  UNIQUE INDEX `ID_usuario_UNIQUE` (`ID_usuario` ASC) VISIBLE,
  UNIQUE INDEX `mail_UNIQUE` (`mail` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`turnos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`turnos` (
  `ID_turno` INT NOT NULL AUTO_INCREMENT,
  `paciente` INT NOT NULL,
  `tipo` INT NOT NULL,
  `especialidad` INT NOT NULL,
  `estado` VARCHAR(45) NOT NULL,
  `fecha_reserva` DATETIME NOT NULL,
  `fecha_turnos` DATETIME NOT NULL,
  PRIMARY KEY (`ID_turno`),
  UNIQUE INDEX `ID_turno_UNIQUE` (`ID_turno` ASC) VISIBLE,
  CONSTRAINT `paciente`
    FOREIGN KEY (`paciente`)
    REFERENCES `hospital`.`pacientes` (`ID_paciente`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_tipo_`
    FOREIGN KEY (`tipo`)
    REFERENCES `hospital`.`tipos_cita` (`ID_tipo`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_especialidad_`
    FOREIGN KEY (`especialidad`)
    REFERENCES `hospital`.`especialidades` (`ID_especialidad`)
    ON DELETE CASCADE
    ON UPDATE CASCADE
    )
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`historial`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`historial` (
  `paciente` INT NOT NULL,
  `situacion` VARCHAR(200) NOT NULL,
  `observaciones` VARCHAR(200) NOT NULL,
  `fecha_modificacion` DATETIME NOT NULL,
  CONSTRAINT `fk_historial`
    FOREIGN KEY (`paciente`)
    REFERENCES `hospital`.`pacientes` (`ID_paciente`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`pacientes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`pacientes` (
  `ID_paciente` INT NOT NULL,
  PRIMARY KEY (`ID_paciente`),
  UNIQUE INDEX `ID_paciente_UNIQUE` (`ID_paciente` ASC) VISIBLE,
  CONSTRAINT `fk_paciente_`
    FOREIGN KEY (`ID_paciente`)
    REFERENCES `hospital`.`usuarios` (`ID_usuario`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`especialidades`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`especialidades` (
  `ID_especialidad` INT NOT NULL AUTO_INCREMENT,
  `especialidad` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`ID_especialidad`),
  UNIQUE INDEX `ID_especialidad_UNIQUE` (`ID_especialidad` ASC) VISIBLE,
  UNIQUE INDEX `especialidad_UNIQUE` (`especialidad` ASC) VISIBLE)
ENGINE = InnoDB
COMMENT = '	';


-- -----------------------------------------------------
-- Table `hospital`.`doctores`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`doctores` (
  `ID_doctor` INT NOT NULL,
  `especialidad` INT NOT NULL,
  `disponibilidad` TINYINT NOT NULL,
  PRIMARY KEY (`ID_doctor`),
  UNIQUE INDEX `ID_doctor_UNIQUE` (`ID_doctor` ASC) VISIBLE,
  INDEX `especialidad_idx` (`especialidad` ASC) VISIBLE,
  CONSTRAINT `ID_doctor`
    FOREIGN KEY (`ID_doctor`)
    REFERENCES `hospital`.`usuarios` (`ID_usuario`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `especialidad`
    FOREIGN KEY (`especialidad`)
    REFERENCES `hospital`.`especialidades` (`ID_especialidad`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`tipos_cita`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`tipos_cita` (
  `ID_tipo` INT NOT NULL AUTO_INCREMENT,
  `tipo` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`ID_tipo`),
  UNIQUE INDEX `ID_tipo_UNIQUE` (`ID_tipo` ASC) VISIBLE,
  UNIQUE INDEX `tipo_UNIQUE` (`tipo` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`citas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`citas` (
  `ID_cita` INT NOT NULL AUTO_INCREMENT,
  `paciente` INT NOT NULL,
  `doctor` INT NOT NULL,
  `tipo` INT NOT NULL,
  PRIMARY KEY (`ID_cita`),
  UNIQUE INDEX `ID_cita_UNIQUE` (`ID_cita` ASC) VISIBLE,
  INDEX `paciente_idx` (`paciente` ASC) VISIBLE,
  INDEX `doctor_idx` (`doctor` ASC) VISIBLE,
  INDEX `tipo_idx` (`tipo` ASC) VISIBLE,
  CONSTRAINT `fk_paciente`
    FOREIGN KEY (`paciente`)
    REFERENCES `hospital`.`pacientes` (`ID_paciente`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_doctor`
    FOREIGN KEY (`doctor`)
    REFERENCES `hospital`.`doctores` (`ID_doctor`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_tipo`
    FOREIGN KEY (`tipo`)
    REFERENCES `hospital`.`tipos_cita` (`ID_tipo`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
COMMENT = '	';


-- -----------------------------------------------------
-- Table `hospital`.`cajeros`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`cajeros` (
  `ID_cajero` INT NOT NULL,
  PRIMARY KEY (`ID_cajero`),
  INDEX `ID_cajero_idx` (`ID_cajero` ASC) VISIBLE,
  CONSTRAINT `fk_cajero`
    FOREIGN KEY (`ID_cajero`)
    REFERENCES `hospital`.`usuarios` (`ID_usuario`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`citas_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`citas_eliminados` (
  `ID_cita` INT NOT NULL,
  `ID_paciente` INT NOT NULL,
  `nombre_paciente` VARCHAR(45) NOT NULL,
  `apellido_paciente` VARCHAR(45) NOT NULL,
  `ID_doctor` INT NOT NULL,
  `nombre_doctor` VARCHAR(45) NOT NULL,
  `apellido_doctor` VARCHAR(45) NOT NULL,
  `tipo` VARCHAR(45) NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_cita`),
  UNIQUE INDEX `ID_cita_UNIQUE` (`ID_cita` ASC) VISIBLE)
ENGINE = InnoDB
COMMENT = '	';


-- -----------------------------------------------------
-- Table `hospital`.`turnos_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`turnos_eliminados` (
  `ID_turno` INT NOT NULL,
  `ID_usuario` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `tipo` VARCHAR(45) NOT NULL,
  `especialidad` VARCHAR(45) NOT NULL,
  `estado` VARCHAR(45) NOT NULL,
  `fecha_reserva` DATETIME NOT NULL,
  `fecha_turnos` DATETIME NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_turno`),
  UNIQUE INDEX `ID_turno_UNIQUE` (`ID_turno` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`usuarios_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`usuarios_eliminados` (
  `ID_usuario` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `mail` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `pass` VARCHAR(45) NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_usuario`),
  UNIQUE INDEX `ID_usuario_UNIQUE` (`ID_usuario` ASC) VISIBLE,
  UNIQUE INDEX `mail_UNIQUE` (`mail` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`cajeros_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`cajeros_eliminados` (
  `ID_usuario` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `mail` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_usuario`),
  UNIQUE INDEX `ID_usuario_UNIQUE` (`ID_usuario` ASC) VISIBLE)
ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `hospital`.`pacientes_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`pacientes_eliminados` (
  `ID_usuario` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `mail` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `situacion` VARCHAR(45) NOT NULL,
  `observaciones` VARCHAR(45) NOT NULL,
  `fecha_modificacion` DATETIME NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_usuario`),
  UNIQUE INDEX `ID_usuario_UNIQUE` (`ID_usuario` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`especialidades_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`especialidades_eliminados` (
  `ID_especialidad` INT NOT NULL AUTO_INCREMENT,
  `especialidad` VARCHAR(45) NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_especialidad`),
  UNIQUE INDEX `ID_especialidad_UNIQUE` (`ID_especialidad` ASC) VISIBLE,
  UNIQUE INDEX `especialidad_UNIQUE` (`especialidad` ASC) VISIBLE)
ENGINE = InnoDB
COMMENT = '	';


-- -----------------------------------------------------
-- Table `hospital`.`doctores_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`doctores_eliminados` (
  `ID_usuario` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `mail` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `especialidad` VARCHAR(45) NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_usuario`),
  UNIQUE INDEX `ID_usuario_UNIQUE` (`ID_usuario` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`tipos_cita_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`tipos_cita_eliminados` (
  `ID_tipo` INT NOT NULL AUTO_INCREMENT,
  `tipo` VARCHAR(45) NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_tipo`),
  UNIQUE INDEX `ID_tipo_UNIQUE` (`ID_tipo` ASC) VISIBLE,
  UNIQUE INDEX `tipo_UNIQUE` (`tipo` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`administrador`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`administrador` (
  `ID_administrador` INT NOT NULL,
  PRIMARY KEY (`ID_administrador`),
  UNIQUE INDEX `ID_administrador_UNIQUE` (`ID_administrador` ASC) VISIBLE,
  CONSTRAINT `fk_administrador`
    FOREIGN KEY (`ID_administrador`)
    REFERENCES `hospital`.`usuarios` (`ID_usuario`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `hospital`.`administradores_eliminados`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hospital`.`administradores_eliminados` (
  `ID_usuario` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `mail` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `fecha_eliminado` DATETIME NOT NULL,
  PRIMARY KEY (`ID_usuario`),
  UNIQUE INDEX `ID_usuario_UNIQUE` (`ID_usuario` ASC) VISIBLE)
ENGINE = InnoDB;



SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

ALTER TABLE `hospital`.`usuarios`
CHANGE `password` `password` VARCHAR(72) NOT NULL;

ALTER TABLE `hospital`.`usuarios_eliminados`
CHANGE `pass` `password` VARCHAR(72) NOT NULL;

ALTER TABLE `hospital`.`historial` change `situacion` `situacion` VARCHAR(200) NOT NULL default ' ';
ALTER TABLE `hospital`.`historial` change `observaciones` `observaciones` VARCHAR(200) NOT NULL default ' ';
ALTER TABLE `hospital`.`historial` change `fecha_modificacion` `fecha_modificacion` DATETIME NOT NULL default now();

ALTER TABLE `hospital`.`doctores` change `disponibilidad` `disponibilidad` TINYINT NOT NULL default 1;

-- ALTER TABLE `hospital`.`citas` CHANGE `fecha` `fecha` DATE NOT NULL DEFAULT DATE(NOW());

--  `situacion` VARCHAR(200) NOT NULL,
--  `observaciones` VARCHAR(200) NOT NULL,  , `observaciones` `observaciones` VARCHAR(200) NOT NULL default ' ' `fecha_modificacion` DATETIME NOT NULL,
-- `disponibilidad` TINYINT NOT NULL,

ALTER TABLE `hospital`.`usuarios`
ADD CONSTRAINT password_minlenght CHECK (CHAR_LENGTH(password) >= 8);

ALTER TABLE `hospital`.`usuarios`
ADD CONSTRAINT id_value CHECK (`ID_usuario` > 0 AND `ID_usuario` < 2147483647);

ALTER TABLE `hospital`.`usuarios`
ADD CONSTRAINT telefono_lenght CHECK (CHAR_LENGTH(`telefono`) = 10);

ALTER TABLE `hospital`.`usuarios`
ADD CONSTRAINT cadena_mail CHECK (mail REGEXP '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.com');

SHOW CREATE TABLE `historial`;

ALTER TABLE `hospital`.`usuarios`
DROP COLUMN  `rol`;

ALTER TABLE `hospital`.`usuarios_eliminados`
DROP COLUMN  `rol`;

ALTER TABLE `hospital`.`citas` ADD `fecha` DATETIME DEFAULT now();

-- ALTER TABLE `hospital`.`citas` ADD CONSTRAINT check_fecha CHECK (`fecha` >= current_timestamp());
DELIMITER //
CREATE TRIGGER fecha_actual
BEFORE INSERT ON `hospital`.`citas` FOR EACH ROW 
	BEGIN IF NEW.`fecha` < NOW() THEN 
		SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Fecha no valida, no puede ser anterior a la fecha actual';
	END IF;
END;
// DELIMITER ;
    

ALTER TABLE `hospital`.`citas_eliminados` ADD `fecha` DATETIME DEFAULT now();

SHOW VARIABLES LIKE 'foreign_key_checks';
SET FOREIGN_KEY_CHECKS = 1;

SELECT VARIABLE_VALUE
FROM performance_schema.global_variables
WHERE VARIABLE_NAME = 'log_error';

-- -------------------------------------------------------------
-- CRUD QUERIES
-- -------------------------------------------------------------

INSERT INTO `hospital`.`usuarios` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`)
VALUES (213563, 'Ricardo', 'Lopez', 'r.lopez@gmail.com', 3333333333, 'poiuytre'),
(643132, 'Carlos', 'Santamaría', 'casa@gmail.com', 3332416754, '09876543'),
(123516, 'Jose', 'Nariño', 'jose.n@gmail.com', 3114261721, 'poiuytre'),
(6435413, 'Alfred', 'Newman', 'alfredenewman@gmail.com', 3202518752, 'qwertyui'),
(7652423, 'Jesse', 'Custer', 'preacher@gmail.com', 3000912989, '98765432'),
(1234368, 'Franco', 'Castillo', 'frank.castle@gmail.com', 3146412329, 'asdfghjk'),
(163566, 'Rodrigo', 'Díaz', 'rodrigo.d@gmail.com', 3054126532, 'zzxcvbnm'),
(865234, 'Vilma', 'Dias', 'vilma@gmail.com', 3174176015, 'mmnbvcxz'),
(8563528, 'Ramon', 'Salazar', 'salazar@gmail.com', 3182639012, 'rewqfdsa'),
(9735234, 'Johana', 'Hernandez', 'j.hernandez@gmail.com', 3162398124, 'poiuytrr'),
(1234156, 'Judy', 'Correa', 'juco@gmail.com', 3241298429, 'poiuylkjh'),
(7745241, 'Mónica', 'Tabares', 'm.tabares@gmail.com', 3172910431, 'dfgherty'),
(7542342, 'Andrea', 'Gil', 'andreagil@gmail.com', 3512127653, '5678tyui'),
(1252686, 'Giovanni', 'Quiroz', 'gio.qui@gmail.com', 3162872543, 'cvbndfgh'),
(864635, 'Claudia', 'Giraldo', 'c.giraldo@gmail.com', 3427281024, 'vbnmmmnbv'),
(7352314, 'Maria', 'Alvarez', 'm.alvarez@gmail.com', 3003837219, 'tgbyhnuj'),
(1432427, 'Cristina', 'Fernandes', 'christine.f@gmail.com', 3332838212, 'asdfzxcv'),
(1188362, 'Blanca', 'Vega', 'blanca@gmail.com', 3302636271, 'qwerzxcv'),
(9683825, 'Wilson', 'Manyoma', 'elpreso@gmail.com', 3002763721, '1234zxcv');

INSERT INTO `hospital`.`usuarios` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`)
VALUES (8093211, 'Walter', 'Blanco', 'heisenberg@gmail.com', 3123454981, 'ijnuhbyg');

INSERT INTO `hospital`.`usuarios` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`)
VALUES (7771151, 'Jose', 'Hernan', 'j.hernan@gmail.com', 3279816521, '1234567890');

INSERT INTO `hospital`.`especialidades` (`especialidad`)
VALUES ('Medicina Interna'),
('Psicología'),
('Radiología'),
('Medicina Familiar'),
('Pediatría'),
('Medicina de Urgencias'),
('Neurología'),
('Cardiología'),
('Obstetricia & Ginecología'),
('Dermatología');

INSERT INTO `hospital`.`tipos_cita` (`tipo`)
VALUES ('Control'),
('Preoperatoria'),
('Seguimiento'),
('Dolencia'),
('Urgencia');

INSERT INTO `hospital`.`pacientes` (`ID_paciente`)
VALUES (213563),
(163566),
(7542342),
(643132),
(123516);

INSERT INTO `hospital`.`pacientes` (`ID_paciente`)
VALUES (324012);

INSERT INTO `hospital`.`doctores` (`ID_doctor`, `especialidad`, `disponibilidad`)
VALUES (8093211, 1, 1),
(163566, 2, 1),
(1234368, 3, 1),
(865234, 4, 1),
(8563528, 5, 1),
(9735234, 6, 1),
(1234156, 7, 1),
(7745241, 8, 1),
(864635, 9, 1),
(1188362, 10, 1);

INSERT INTO `hospital`.`doctores` (`ID_doctor`, `especialidad`, `disponibilidad`)
VALUES (655443, 6, 1);

INSERT INTO `hospital`.`administrador` (`ID_administrador`)
VALUES (7652423),
(9683825);
INSERT INTO `hospital`.`administrador` (`ID_administrador`)
VALUES (6665551);

INSERT INTO `hospital`.`cajeros` (`ID_cajero`)
VALUES (1432427),
(7352314),
(1252686);

INSERT INTO `hospital`.`historial` (`paciente`, `situacion`, `observaciones`, `fecha_modificacion`)
VALUES (213563, ' ', ' ', now()),
(7542342, ' ', ' ', now()),
(643132, ' ', ' ', now()),
(123516, ' ', ' ', now());

INSERT INTO `hospital`.`historial` (`paciente`, `situacion`, `observaciones`, `fecha_modificacion`)
VALUES (213563, ' ', ' ', now());

-- '214748', '324012'

INSERT INTO `hospital`.`turnos`(`paciente`, `tipo`, `especialidad`, `estado`, `fecha_reserva`, `fecha_turnos`)
VALUES (7542342, 2, 2, 'PENDIENTE', now(), '2023-10-23');

INSERT INTO `hospital`.`turnos`(`paciente`, `tipo`, `especialidad`, `estado`, `fecha_reserva`, `fecha_turnos`)
VALUES (213563, 1, 10, 'PENDIENTE', now(), '2023-10-23');

INSERT INTO `hospital`.`turnos`(`paciente`, `tipo`, `especialidad`, `estado`, `fecha_reserva`, `fecha_turnos`)
VALUES (163566, 2, 7, 'PENDIENTE', now(), '2023-10-23');

INSERT INTO `hospital`.`turnos`(`paciente`, `tipo`, `especialidad`, `estado`, `fecha_reserva`, `fecha_turnos`)
VALUES (643132, 3, 6, 'PENDIENTE', now(), '2023-10-23');

INSERT INTO `hospital`.`citas`(`paciente`, `doctor`, `tipo`, `fecha`)
VALUES ('7542342', '864635' , 2, '2023-11-09 13:00:00');

INSERT INTO `hospital`.`citas`(`paciente`, `doctor`, `tipo`, `fecha`)
VALUES ('123516', '7745241' , 3, '2023-10-28 09:00:00');

INSERT INTO `hospital`.`citas`(`paciente`, `doctor`, `tipo`, `fecha`)
VALUES ('7654390', '9735234' , 3, '2023-10-29 10:00:00');

INSERT INTO `hospital`.`citas`(`paciente`, `doctor`, `tipo`, `fecha`)
VALUES ('163566', '9735234' , 4, '2023-10-29 13:00:00');

INSERT INTO `hospital`.`citas`(`paciente`, `doctor`, `tipo`, `fecha`)
VALUES ('643132', '1188362' , 1, '2023-10-30 10:00:00');

SELECT `ID_usuario`, length(`telefono`) FROM `hospital`.`usuarios`;

SELECT * FROM `hospital`.`usuarios`;
SELECT * FROM `hospital`.`pacientes`;
SELECT * FROM `hospital`.`doctores`;
SELECT * FROM `hospital`.`cajeros`;
SELECT * FROM `hospital`.`administrador`;
SELECT * FROM `hospital`.`tipos_cita`;
SELECT * FROM `hospital`.`especialidades`;
SELECT * FROM `hospital`.`historial`;
SELECT * FROM `hospital`.`citas`;

-- VISTAS BÁSICAS
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono` FROM `hospital`.`usuarios` INNER JOIN `hospital`.`cajeros` ON `usuarios`.`ID_usuario` = `cajeros`.`ID_cajero`;
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono` FROM `hospital`.`usuarios` INNER JOIN `hospital`.`administrador` ON `usuarios`.`ID_usuario` = `administrador`.`ID_administrador`;


-- VISTA HISTORIAL
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono`, `historial`.`situacion` , `historial`.`observaciones`, `historial`.`fecha_modificacion`
FROM (`hospital`.`usuarios` INNER JOIN `hospital`.`pacientes` ON `usuarios`.`ID_usuario` = `pacientes`.`ID_paciente`) INNER JOIN `hospital`.`historial` ON `pacientes`.`ID_paciente` = `historial`.`paciente`;

-- VISTA MEDICO
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono`, `especialidades`.`especialidad`
FROM (`hospital`.`usuarios` INNER JOIN `hospital`.`doctores` ON `usuarios`.`ID_usuario` = `doctores`.`ID_doctor`) INNER JOIN `hospital`.`especialidades` ON `doctores`.`especialidad` = `especialidades`.`ID_especialidad`;

-- VISTA MEDICOS DISPONIBLES
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono`, `especialidades`.`especialidad`
FROM (`hospital`.`usuarios` INNER JOIN `hospital`.`doctores` ON `usuarios`.`ID_usuario` = `doctores`.`ID_doctor`) INNER JOIN `hospital`.`especialidades` ON `doctores`.`especialidad` = `especialidades`.`ID_especialidad`
WHERE `doctores`.`disponibilidad` = TRUE;

-- VISTA TURNOS
SELECT `turnos`.`ID_turno`, `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `tipos_cita`.`tipo`, `especialidades`.`especialidad`, `turnos`.`estado`, `turnos`.`fecha_reserva`, `turnos`.`fecha_turnos`
FROM ((`hospital`.`turnos` INNER JOIN `hospital`.`usuarios` ON `turnos`.`paciente` = `usuarios`.`ID_usuario`)
INNER JOIN `hospital`.`tipos_cita` ON `turnos`.`tipo` = `tipos_cita`.`ID_tipo`)
INNER JOIN `hospital`.`especialidades` ON `turnos`.`especialidad` = `especialidades`.`ID_especialidad`
ORDER BY CASE
		WHEN `tipos_cita`.`tipo` = 'URGENCIA' THEN 1
        WHEN `tipos_cita`.`tipo` = 'DOLENCIA' THEN 2
        ELSE 3 END;

-- VISTA CITAS
SELECT `citas`.`ID_cita`, (SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS ID_Paciente, 
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Nombre_Paciente,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Apellido_Paciente,
(SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS ID_Doctor,
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Nombre_Doctor,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Apellido_Doctor, 
`tipos_cita`.`tipo`, `citas`.`fecha`
FROM (`hospital`.`citas` INNER JOIN `hospital`.`tipos_cita` ON `citas`.`tipo` = `tipos_cita`.`ID_tipo`); 

-- VISTA DE CITA MÁS PROXIMA
SELECT `citas`.`ID_cita`, (SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS ID_Paciente, 
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Nombre_Paciente,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Apellido_Paciente,
(SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS ID_Doctor,
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Nombre_Doctor,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Apellido_Doctor, 
`tipos_cita`.`tipo`, `citas`.`fecha`
FROM (`hospital`.`citas` INNER JOIN `hospital`.`tipos_cita` ON `citas`.`tipo` = `tipos_cita`.`ID_tipo`) 
ORDER BY abs(TIMESTAMPDIFF(SECOND, `citas`.`fecha`, now())) LIMIT 1; 

-- VISTA DE CITA ACTUAL
SELECT `citas`.`ID_cita`, (SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS ID_Paciente, 
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Nombre_Paciente,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Apellido_Paciente,
(SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS ID_Doctor,
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Nombre_Doctor,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Apellido_Doctor, 
`tipos_cita`.`tipo`, `citas`.`fecha`
FROM (`hospital`.`citas` INNER JOIN `hospital`.`tipos_cita` ON `citas`.`tipo` = `tipos_cita`.`ID_tipo`) 
WHERE  DATE(`citas`.`fecha`) = curdate();

-- ACTUALIZACION DE TURNOS
UPDATE `hospital`.`turnos` SET `turnos`.`estado` = 'FACTURADO' WHERE `turnos`.`ID_turno` = 1;

-- ACTUALIZACION DE HISTORIAL
UPDATE `hospital`.`historial` 
SET `situacion` = 'El paciente se encuentra estable', `observaciones` = 'Se sugiere mantener reposo durante dos dias para que el problema no se presente otra vez', `fecha_modificacion` = now()
WHERE `historial`.`paciente` = 213563;

-- ACTUALIZACION DE USUARIO

UPDATE `hospital`.`usuarios` SET `mail` = 'a.gil@gmail.com' WHERE `usuarios`.`ID_usuario` = 7542342;
UPDATE `hospital`.`usuarios` SET `telefono` = '3164569832' WHERE `usuarios`.`ID_usuario` = 9735234;

-- ----------------------------------------------------------------------------------------
-- PRUEBAS DE TABLAS ARCHIVADO
-- ---------------------------------------------------------------------------------------

-- CREACION DE REGISTROS A BORRAR
INSERT INTO `hospital`.`usuarios` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`)
VALUES (678123, 'Miguel', 'Aristizabal', 'migue@gmail.com', 3134212343, 'poiuytre');
INSERT INTO `hospital`.`pacientes` (`ID_paciente`)
VALUES (678123);


INSERT INTO `hospital`.`especialidades` (`especialidad`)
VALUES ('Ortodoncia');

INSERT INTO `hospital`.`tipos_cita` (`tipo`)
VALUES ('Urología');

INSERT INTO `hospital`.`usuarios` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`)
VALUES (888881, 'Diego', 'Arazabal', 'die@gmail.com', 3435421243, 'poiuytre');
INSERT INTO `hospital`.`doctores` (`ID_doctor`, `especialidad`, `disponibilidad`)
VALUES (888881, 2, 1);

INSERT INTO `hospital`.`usuarios` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`)
VALUES (9292929, 'Mateo', 'Mesa', 'mame@gmail.com', 3167829092, 'poiuytre');
INSERT INTO `hospital`.`cajeros` (`ID_cajero`)
VALUES (9292929);

INSERT INTO `hospital`.`usuarios` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`)
VALUES (121212, 'Mario', 'Merlano', 'm.merlano@gmail.com', 3125469832, 'poiuytre');
INSERT INTO `hospital`.`administrador` (`ID_administrador`)
VALUES (121212);

INSERT INTO `hospital`.`turnos`(`paciente`, `tipo`, `especialidad`, `estado`, `fecha_reserva`, `fecha_turnos`)
VALUES (213563, 1, 8, 'PENDIENTE', now(), '2023-10-23');

INSERT INTO `hospital`.`citas`(`paciente`, `doctor`, `tipo`)
VALUES (213563, '7745241' , 1);

-- TRASLADO A TABLAS DE ARCHIVADO

INSERT INTO `hospital`.`usuarios_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`, `fecha_eliminado`)
SELECT `ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`, now() FROM `hospital`.`usuarios`
WHERE `usuarios`.`ID_usuario` = 643132;

INSERT INTO `hospital`.`pacientes_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `situacion`, `observaciones`, `fecha_modificacion`, `fecha_eliminado`)
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono`, `historial`.`situacion` , `historial`.`observaciones`, `historial`.`fecha_modificacion`, now()
FROM (`hospital`.`usuarios` INNER JOIN `hospital`.`pacientes` ON `usuarios`.`ID_usuario` = `pacientes`.`ID_paciente`) INNER JOIN `hospital`.`historial` ON `pacientes`.`ID_paciente` = `historial`.`paciente`;


INSERT INTO `hospital`.`usuarios_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `pass`, `fecha_eliminado`)
SELECT `ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`, now() FROM `hospital`.`usuarios`
WHERE `usuarios`.`ID_usuario` = 888881;

INSERT INTO `hospital`.`doctores_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `especialidad`, `fecha_eliminado`)
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono`, `especialidades`.`especialidad`, now()
FROM (`hospital`.`usuarios` INNER JOIN `hospital`.`doctores` ON `usuarios`.`ID_usuario` = `doctores`.`ID_doctor`) INNER JOIN `hospital`.`especialidades` ON `doctores`.`especialidad` = `especialidades`.`ID_especialidad` 
WHERE `usuarios`.`ID_usuario` = 888881;

INSERT INTO `hospital`.`usuarios_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `pass`, `fecha_eliminado`)
SELECT `ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`, now() FROM `hospital`.`usuarios`
WHERE `usuarios`.`ID_usuario` = 9292929;

INSERT INTO `hospital`.`cajeros_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `fecha_eliminado`)
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono`, now() FROM `hospital`.`usuarios` INNER JOIN `hospital`.`cajeros` ON `usuarios`.`ID_usuario` = `cajeros`.`ID_cajero`
WHERE `usuarios`.`ID_usuario` = 9292929;


INSERT INTO `hospital`.`usuarios_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `pass`, `fecha_eliminado`)
SELECT `ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `password`, now() FROM `hospital`.`usuarios`
WHERE `usuarios`.`ID_usuario` = 121212;

INSERT INTO `hospital`.`administradores_eliminados` (`ID_usuario`, `nombre`, `apellido`, `mail`, `telefono`, `fecha_eliminado`)
SELECT `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `usuarios`.`mail`, `usuarios`.`telefono`, now() FROM `hospital`.`usuarios` INNER JOIN `hospital`.`administrador` ON `usuarios`.`ID_usuario` = `administrador`.`ID_administrador`
WHERE `usuarios`.`ID_usuario` = 121212;


INSERT INTO `hospital`.`especialidades_eliminados` (`ID_especialidad`, `especialidad`, `fecha_eliminado`)
SELECT `ID_especialidad`, `especialidad`, now() FROM `hospital`.`especialidades`
WHERE `especialidades`.`ID_especialidad` = 11;

INSERT INTO `hospital`.`tipos_cita_eliminados` (`ID_tipo`, `tipo`, `fecha_eliminado`)
SELECT `ID_tipo`, `tipo`, now() FROM `hospital`.`tipos_cita`
WHERE `tipos_cita`.`ID_tipo` = 6;

INSERT INTO `hospital`.`turnos_eliminados` (`ID_turno`, `ID_usuario`, `nombre`, `apellido`, `tipo`, `especialidad`, `estado`, `fecha_reserva`, `fecha_turnos`, `fecha_eliminado`)
SELECT `ID_turno`, `usuarios`.`ID_usuario`, `usuarios`.`nombre`, `usuarios`.`apellido`, `tipos_cita`.`tipo`, `especialidades`.`especialidad`, `turnos`.`estado`, `turnos`.`fecha_reserva`, `turnos`.`fecha_turnos`, now()
FROM ((`hospital`.`turnos` INNER JOIN `hospital`.`usuarios` ON `turnos`.`paciente` = `usuarios`.`ID_usuario`)
INNER JOIN `hospital`.`tipos_cita` ON `turnos`.`tipo` = `tipos_cita`.`ID_tipo`)
INNER JOIN `hospital`.`especialidades` ON `turnos`.`especialidad` = `especialidades`.`ID_especialidad`
WHERE `turnos`.`ID_turno` = 1;
-- ID_turno, ID_usuario, nombre, apellido, tipo, especialidad, estado, fecha_reserva, fecha_turnos, fecha_eliminados

INSERT INTO `hospital`.`citas_eliminados` (`ID_cita`, `ID_Paciente`, `Nombre_Paciente`, `Apellido_Paciente`, `ID_Doctor`, `Nombre_Doctor`, `Apellido_Doctor`, `tipo`, `fecha_eliminado`, `fecha`)
SELECT `citas`.`ID_cita`, (SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS ID_Paciente, 
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Nombre_Paciente,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`paciente` = `usuarios`.`ID_usuario`) AS Apellido_Paciente,
(SELECT `usuarios`.`ID_usuario` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS ID_Doctor,
(SELECT `usuarios`.`nombre` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Nombre_Doctor,
(SELECT `usuarios`.`apellido` FROM `hospital`.`usuarios` WHERE `citas`.`doctor` = `usuarios`.`ID_usuario`) AS Apellido_Doctor, 
`tipos_cita`.`tipo`, now(), `citas`.`fecha` 
FROM (`hospital`.`citas` INNER JOIN `hospital`.`tipos_cita` ON `citas`.`tipo` = `tipos_cita`.`ID_tipo`)
WHERE `citas`.`ID_cita` = 3;

-- `ID_cita`, `ID_Paciente`, `Nombre_Paciente`, `Apellido_Paciente`, `ID_Doctor`, `Nombre_Doctor`, `Apellido_Doctor`, `tipo`, `fecha_eliminados`

-- BORRADO DE REGISTROS

DELETE FROM `hospital`.`usuarios` WHERE `ID_usuario` = 643132;

DELETE FROM `hospital`.`pacientes` WHERE `ID_paciente` = 163566;

DELETE FROM `hospital`.`usuarios` WHERE `ID_usuario` = 121212;

DELETE FROM `hospital`.`usuarios` WHERE `ID_usuario` = 888881;

DELETE FROM `hospital`.`usuarios` WHERE `ID_usuario` = 9292929;

DELETE FROM `hospital`.`tipos_cita` WHERE `ID_tipo` = 6;

DELETE FROM `hospital`.`especialidades` WHERE `ID_especialidad` = 11;

DELETE FROM `hospital`.`turnos` WHERE `ID_turno` = 1;

DELETE FROM `hospital`.`turnos` WHERE `estado` = 'FACTURADO';

DELETE FROM `hospital`.`citas` WHERE `ID_cita` = 7;


-- VISUALIZACION DE TABLAS DE ARCHIVADO
SELECT * FROM `hospital`.`usuarios_eliminados`;
SELECT * FROM `hospital`.`pacientes_eliminados`;
SELECT * FROM `hospital`.`doctores_eliminados`;
SELECT * FROM `hospital`.`cajeros_eliminados`; 
SELECT * FROM `hospital`.`administradores_eliminados`;
SELECT * FROM `hospital`.`tipos_cita_eliminados`;
SELECT * FROM `hospital`.`especialidades_eliminados`;
SELECT * FROM `hospital`.`turnos_eliminados`;
SELECT * FROM `hospital`.`citas_eliminados`;

-- Error Code: 3730. Cannot drop table 'auth_user' referenced by a foreign key constraint 'auth_user_groups_user_id_6a12ed8b_fk_auth_user_id' on table 'auth_user_groups'.

UPDATE `hospital`.`usuarios` SET `password` = '1234567890' WHERE `ID_usuario` = 6665551;

-- 789789 5432154 6665551